!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).rovingGridUx={})}(this,function(e){function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=new Map,a="rtl"===window.getComputedStyle(document.documentElement).direction,i={TOP_LEFT:[],TOP:["Ctrl+Home","Meta+ArrowUp"],TOP_RIGHT:[],UP:["ArrowUp"],DOWN:["ArrowDown"],HOME:["Home","Meta+ArrowLeft"],END:["End","Meta+ArrowRight"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"],BOTTOM_LEFT:[],BOTTOM:["Ctrl+End","Meta+ArrowDown"],BOTTOM_RIGHT:[]},c=function(e,t){if((t.includes("ArrowLeft")||1==t.length)&&!t.includes("Home")){var n=e.findIndex(function(e){return e.includes("ArrowRight")||1==e.length});return-1!==n?e[n]:t}if((t.includes("ArrowRight")||1==t.length)&&!t.includes("End")){var r=e.findIndex(function(e){return e.includes("ArrowLeft")||1==e.length});return-1!==r?e[r]:t}return t},s=function(e){void 0===e&&(e={});var n=t({},i,e);if(a){var r=[n.RIGHT,n.LEFT];n.LEFT=r[0],n.RIGHT=r[1];var o=[n.TOP_RIGHT,n.TOP_LEFT];n.TOP_LEFT=o[0],n.TOP_RIGHT=o[1];var s=[n.BOTTOM_RIGHT,n.BOTTOM_LEFT];n.BOTTOM_LEFT=s[0],n.BOTTOM_RIGHT=s[1];var u=n.HOME,f=n.END;n.HOME=u.map(function(e){return c(f,e)}),n.END=f.map(function(e){return c(u,e)})}for(var l in n)n[l]=n[l].map(function(e){return e.split("+").map(function(e){return 1===e.length?e.toUpperCase():e}).join("+")});var d={},v=function(e){n[e].forEach(function(t){d[t]=e})};for(var g in n)v(g);return d},u=function(e){for(var t,n=e.currentTarget,a=o.get(n),i=r([].concat(a.targets).entries());!(t=i()).done;){var c=t.value,s=c[0],u=c[1];if(u.contains(e.target)){e.preventDefault(),a.index=s,a.focused=!0,A(n,u),o.set("last_rover",n);break}}},f=function(e){var t=e.currentTarget,n=e.target;if(o.has(t)){var r=o.get(t),a=[].concat(r.targets).indexOf(n);-1!==a&&r.index!==a&&(r.index=a,r.focused=!0,A(t,n),o.set("last_rover",t))}},l=function(e){var t=o.get(e.currentTarget);t&&(t.focused=!1)},d=function(e){var t=e.currentTarget,n=function(e){var t=[e.ctrlKey?"Ctrl":null,e.altKey?"Alt":null,e.shiftKey?"Shift":null,e.metaKey?"Meta":null].filter(Boolean),n=1===e.key.length?e.key.toUpperCase():e.key;return t.length>0?t.join("+")+"+"+n:n}(e);switch(o.get(t).keyBinds[n]){case"RIGHT":e.preventDefault(),p(t);break;case"LEFT":e.preventDefault(),h(t);break;case"DOWN":e.preventDefault(),T(t);break;case"UP":e.preventDefault(),x(t);break;case"HOME":e.preventDefault(),w(t);break;case"END":e.preventDefault(),O(t);break;case"BOTTOM":e.preventDefault(),E(t);break;case"TOP":e.preventDefault(),y(t);break;case"TOP_LEFT":e.preventDefault(),M(t);break;case"TOP_RIGHT":e.preventDefault(),k(t);break;case"BOTTOM_LEFT":e.preventDefault(),L(t);break;case"BOTTOM_RIGHT":e.preventDefault(),I(t)}},v=function(e,n){var a=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&e.contains(a.target)&&function(e,n){var a,i,c=e.querySelectorAll(n),s=m(e,c),u=b(e,c),f=o.get(e),l=f.columns,d=f.index,v=Math.floor(d/l),g=d%l,p=Math.min(v,u-1)*s+Math.min(g,s-1),h=c[p];if(h.disabled||h.inert){for(var T,x=r(c);!(T=x()).done;){var w=T.value;if(!w.disabled&&!w.inert){a=w;break}}i=[].concat(c).indexOf(a)}else a=h,i=p;c.forEach(function(e){return e.tabIndex=-1}),a.tabIndex=0,f.focused&&A(e,a),o.set(e,t({},f,{targets:c,columns:s,rows:u,active:a,index:i}))}(e,n)})});return a.observe(e,{childList:!0,subtree:!0}),a},g=function(e,n){var r=new ResizeObserver(function(){return function(e){var n=o.get(e),r=m(e,[].concat(n.targets)),a=b(e,[].concat(n.targets));o.set(e,t({},n,{columns:r,rows:a}))}(e)});return[e].concat(e.querySelectorAll(n)).forEach(function(e){r.observe(e)}),r},m=function(e,t){var n=window.getComputedStyle(e);if(n.getPropertyValue("grid-template-columns"))return n.getPropertyValue("grid-template-columns").split(" ").length;for(var r=e.offsetWidth,o=[].concat(t),a=0,i=0,c=0,s=o.length;c<s;c++){var u=o[c];a+=Math.floor(u.offsetWidth);var f=t[c+1];if(f){var l=f.offsetLeft-(u.offsetLeft+u.offsetWidth);l>0&&(a+=Math.floor(l))}if(a>r)break;i++}return i},b=function(e,t){var n=window.getComputedStyle(e);return n.getPropertyValue("grid-template-rows")?n.getPropertyValue("grid-template-rows").split(" ").length:Math.ceil(t.length/m(e,t))},p=function(e){for(var t=o.get(e),n=Math.floor(t.index/t.columns),r=t.wrap?t.targets.length-1:(n+1)*t.columns-1,a=t.index;a<r;){a++;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,A(e,i);break}}},h=function(e){for(var t=o.get(e),n=Math.floor(t.index/t.columns),r=t.wrap?0:n*t.columns,a=t.index;a>r;){a--;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,A(e,i);break}}},T=function(e){for(var t=o.get(e),n=t.rows*t.columns+t.index%t.columns,r=t.index;r<n;){var a=t.targets[r+=t.columns];if(a&&!a.inert&&!a.disabled){t.index=r,A(e,a);break}}},x=function(e){for(var t=o.get(e),n=t.index%t.columns,r=t.index;r>n;){var a=t.targets[r-=t.columns];if(a&&!a.inert&&!a.disabled){t.index=r,A(e,a);break}}},w=function(e){for(var t=o.get(e),n=Math.floor(t.index/t.columns),r=0;r<t.columns;){var a=t.targets[n*t.columns+r];if(a&&!a.inert&&!a.disabled)break;r++}t.index=n*t.columns+r;var i=t.targets[t.index];i&&A(e,i)},O=function(e){for(var t=o.get(e),n=Math.floor(t.index/t.columns),r=t.columns-1;r>=0;){var a=t.targets[n*t.columns+r];if(a&&!a.inert&&!a.disabled)break;r--}t.index=n*t.columns+r;var i=t.targets[t.index];i&&A(e,i)},y=function(e){for(var t=o.get(e),n=Math.floor(t.index/t.columns),r=0;r<n;){var a=t.targets[t.index+(r-n)*t.columns];if(a&&!a.inert&&!a.disabled)break;r++}t.index+=t.columns*(r-n);var i=t.targets[t.index];i&&A(e,i)},E=function(e){for(var t=o.get(e),n=Math.floor(t.index/t.columns),r=t.rows-1;r>n;){var a=t.targets[t.index+(r-n)*t.columns];if(a&&!a.inert&&!a.disabled)break;r--}t.index+=t.columns*(r-n);var i=t.targets[t.index];i&&A(e,i)},M=function(e){var t=o.get(e),n=t.targets[0];!n||n.inert||n.disabled||(t.index=0,A(e,n))},k=function(e){var t=o.get(e),n=t.targets[t.columns-1];!n||n.inert||n.disabled||(t.index=t.columns-1,A(e,n))},L=function(e){var t=o.get(e),n=t.targets[t.columns*(t.rows-1)];!n||n.inert||n.disabled||(t.index=t.columns*(t.rows-1),A(e,n))},I=function(e){var t=o.get(e),n=t.targets[t.columns*t.rows-1];!n||n.inert||n.disabled||(t.index=t.columns*t.rows-1,A(e,n))},A=function(e,t){var n=o.get(e);n.active.tabIndex=-1,n.active=t,n.active.tabIndex=0,n.active.focus(),n.focused=!0};e.rovingGrid=function(e){for(var t,n,a=e.element,i=e.target,c=void 0===i?":scope *":i,p=e.wrap,h=void 0===p||p,T=e.VKMap,x=void 0===T?{}:T,w=a.querySelectorAll(c),O=r(w);!(n=O()).done;){var y=n.value;if(!y.disabled&&!y.inert){t=y;break}}var E=[].concat(w).indexOf(t),M=m(a,w),k=b(a,w),L=s(x);a.tabIndex=-1,w.forEach(function(e){return e.tabIndex=-1}),t.tabIndex=0,o.set(a,{targets:w,wrap:h,active:t,index:E,rows:k,columns:M,focused:!1,keyBinds:L}),a.addEventListener("pointerdown",u),a.addEventListener("focusin",f),a.addEventListener("focusout",l),a.addEventListener("keydown",d),function(e,t){void 0===t&&(t=[]);var n=e.parentNode,r=new MutationObserver(function(e){e.filter(function(e){return e.removedNodes.length>0}).forEach(function(e){[].concat(e.removedNodes).filter(function(e){return 1===e.nodeType}).forEach(function(e){o.forEach(function(n,a){"last_rover"!==a&&e.contains(a)&&(a.removeEventListener("pointerdown",u),a.removeEventListener("focusin",f),a.removeEventListener("focusout",l),a.removeEventListener("keydown",d),o.delete(a),n.targets.forEach(function(e){return e.tabIndex=""}),(0===o.size||1===o.size&&o.has("last_rover"))&&(o.clear(),r.disconnect(),t.forEach(function(e){return e.disconnect()})))})})})});r.observe(n,{childList:!0,subtree:!0})}(a,{observers:[v(a,c),g(a,c)]})},e.updateRover=function(e,n){var r=o.get(e);if(!r)throw new Error("Rover not found");var a=t({},r,n);n.VKMap&&(a.keyBinds=s(n.VKMap)),o.set(e,a)}});
//# sourceMappingURL=index.umd.js.map
