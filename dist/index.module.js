function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.apply(this,arguments)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=new Map,o="rtl"===window.getComputedStyle(document.documentElement).direction,a={TOP_LEFT:[],TOP:["Ctrl+Home","Meta+ArrowUp"],TOP_RIGHT:[],UP:["ArrowUp"],DOWN:["ArrowDown"],HOME:["Home","Meta+ArrowLeft"],END:["End","Meta+ArrowRight"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"],BOTTOM_LEFT:[],BOTTOM:["Ctrl+End","Meta+ArrowDown"],BOTTOM_RIGHT:[]},i=function(e,t){if((t.includes("ArrowLeft")||1==t.length)&&!t.includes("Home")){var r=e.findIndex(function(e){return e.includes("ArrowRight")||1==e.length});return-1!==r?e[r]:t}if((t.includes("ArrowRight")||1==t.length)&&!t.includes("End")){var n=e.findIndex(function(e){return e.includes("ArrowLeft")||1==e.length});return-1!==n?e[n]:t}return t},s=function(t){void 0===t&&(t={});var r=e({},a,t);if(o){var n=[r.RIGHT,r.LEFT];r.LEFT=n[0],r.RIGHT=n[1];var s=[r.TOP_RIGHT,r.TOP_LEFT];r.TOP_LEFT=s[0],r.TOP_RIGHT=s[1];var c=[r.BOTTOM_RIGHT,r.BOTTOM_LEFT];r.BOTTOM_LEFT=c[0],r.BOTTOM_RIGHT=c[1];var u=r.HOME,f=r.END;r.HOME=u.map(function(e){return i(f,e)}),r.END=f.map(function(e){return i(u,e)})}for(var l in r)r[l]=r[l].map(function(e){return e.split("+").map(function(e){return 1===e.length?e.toUpperCase():e}).join("+")});var d={},v=function(e){r[e].forEach(function(t){d[t]=e})};for(var g in r)v(g);return d},c=function(e){for(var t,o=e.currentTarget,a=n.get(o),i=r([].concat(a.targets).entries());!(t=i()).done;){var s=t.value,c=s[0],u=s[1];if(u.contains(e.target)){e.preventDefault(),a.index=c,a.focused=!0,A(o,u),n.set("last_rover",o);break}}},u=function(e){var t=e.currentTarget,r=e.target;if(n.has(t)){var o=n.get(t),a=[].concat(o.targets).indexOf(r);-1!==a&&o.index!==a&&(o.index=a,o.focused=!0,A(t,r),n.set("last_rover",t))}},f=function(e){var t=n.get(e.currentTarget);t&&(t.focused=!1)},l=function(e){var t=e.currentTarget,r=function(e){var t=[e.ctrlKey?"Ctrl":null,e.altKey?"Alt":null,e.shiftKey?"Shift":null,e.metaKey?"Meta":null].filter(Boolean),r=1===e.key.length?e.key.toUpperCase():e.key;return t.length>0?t.join("+")+"+"+r:r}(e);switch(n.get(t).keyBinds[r]){case"RIGHT":e.preventDefault(),p(t);break;case"LEFT":e.preventDefault(),h(t);break;case"DOWN":e.preventDefault(),T(t);break;case"UP":e.preventDefault(),x(t);break;case"HOME":e.preventDefault(),w(t);break;case"END":e.preventDefault(),O(t);break;case"BOTTOM":e.preventDefault(),y(t);break;case"TOP":e.preventDefault(),E(t);break;case"TOP_LEFT":e.preventDefault(),M(t);break;case"TOP_RIGHT":e.preventDefault(),k(t);break;case"BOTTOM_LEFT":e.preventDefault(),L(t);break;case"BOTTOM_RIGHT":e.preventDefault(),I(t)}},d=function(t){var r=n.get(t),o=v(t,[].concat(r.targets)),a=g(t,[].concat(r.targets));n.set(t,e({},r,{columns:o,rows:a}))},v=function(e,t){var r=window.getComputedStyle(e);if(r.getPropertyValue("grid-template-columns"))return r.getPropertyValue("grid-template-columns").split(" ").length;for(var n=e.offsetWidth,o=[].concat(t),a=0,i=0,s=0,c=o.length;s<c;s++){var u=o[s];a+=Math.floor(u.offsetWidth);var f=t[s+1];if(f){var l=f.offsetLeft-(u.offsetLeft+u.offsetWidth);l>0&&(a+=Math.floor(l))}if(a>n)break;i++}return i},g=function(e,t){var r=window.getComputedStyle(e);return r.getPropertyValue("grid-template-rows")?r.getPropertyValue("grid-template-rows").split(" ").length:Math.ceil(t.length/v(e,t))},m=function(t){for(var o,a,i=t.element,m=t.target,b=void 0===m?":scope *":m,p=t.wrap,h=void 0===p||p,T=t.VKMap,x=void 0===T?{}:T,w=i.querySelectorAll(b),O=r(w);!(a=O()).done;){var E=a.value;if(!E.disabled&&!E.inert){o=E;break}}var y=[].concat(w).indexOf(o),M=v(i,w),k=g(i,w),L=s(x);i.tabIndex=-1,w.forEach(function(e){return e.tabIndex=-1}),o.tabIndex=0,n.set(i,{targets:w,wrap:h,active:o,index:y,rows:k,columns:M,focused:!1,keyBinds:L}),i.addEventListener("pointerdown",c),i.addEventListener("focusin",u),i.addEventListener("focusout",f),i.addEventListener("keydown",l);var I=function(t,o){var a=new MutationObserver(function(a,i){a.forEach(function(a){"childList"===a.type&&t.contains(a.target)&&function(t,o){var a,i,s=t.querySelectorAll(o),c=v(t,s),u=g(t,s),f=n.get(t),l=f.columns,d=f.index,m=Math.floor(d/l),b=d%l,p=Math.min(m,u-1)*c+Math.min(b,c-1),h=s[p];if(h.disabled||h.inert){for(var T,x=r(s);!(T=x()).done;){var w=T.value;if(!w.disabled&&!w.inert){a=w;break}}i=[].concat(s).indexOf(a)}else a=h,i=p;s.forEach(function(e){return e.tabIndex=-1}),a.tabIndex=0,f.focused&&A(t,a),n.set(t,e({},f,{targets:s,columns:c,rows:u,active:a,index:i}))}(t,o)})});return a.observe(t,{childList:!0,subtree:!0}),a}(i,b),D=function(e,t){var n=new ResizeObserver(function(t){for(var n=r(t);!n().done;)d(e)});return n.observe(e),e.querySelectorAll(t).forEach(function(e){n.observe(e)}),n}(i,b);!function(e,t){var r=(void 0===t?{}:t).observers,o=void 0===r?[]:r,a=e.parentNode,i=new MutationObserver(function(e,t){e.filter(function(e){return e.removedNodes.length>0}).forEach(function(e){[].concat(e.removedNodes).filter(function(e){return 1===e.nodeType}).forEach(function(e){n.forEach(function(t,r){"last_rover"!==r&&e.contains(r)&&(r.removeEventListener("pointerdown",c),r.removeEventListener("focusin",u),r.removeEventListener("focusout",f),r.removeEventListener("keydown",l),n.delete(r),t.targets.forEach(function(e){return e.tabIndex=""}),(0===n.size||1===n.size&&n.has("last_rover"))&&(n.clear(),i.disconnect(),o.forEach(function(e){return e.disconnect()})))})})})});i.observe(a,{childList:!0,subtree:!0})}(i,{observers:[I,D]})},b=function(t,r){var o=n.get(t);if(!o)throw new Error("Rover not found");var a=e({},o,r);r.VKMap&&(a.keyBinds=s(r.VKMap)),n.set(t,a)},p=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.wrap?t.targets.length-1:(r+1)*t.columns-1,a=t.index;a<o;){a++;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,A(e,i);break}}},h=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.wrap?0:r*t.columns,a=t.index;a>o;){a--;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,A(e,i);break}}},T=function(e){for(var t=n.get(e),r=t.rows*t.columns+t.index%t.columns,o=t.index;o<r;){var a=t.targets[o+=t.columns];if(a&&!a.inert&&!a.disabled){t.index=o,A(e,a);break}}},x=function(e){for(var t=n.get(e),r=t.index%t.columns,o=t.index;o>r;){var a=t.targets[o-=t.columns];if(a&&!a.inert&&!a.disabled){t.index=o,A(e,a);break}}},w=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=0;o<t.columns;){var a=t.targets[r*t.columns+o];if(a&&!a.inert&&!a.disabled)break;o++}t.index=r*t.columns+o;var i=t.targets[t.index];i&&A(e,i)},O=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.columns-1;o>=0;){var a=t.targets[r*t.columns+o];if(a&&!a.inert&&!a.disabled)break;o--}t.index=r*t.columns+o;var i=t.targets[t.index];i&&A(e,i)},E=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=0;o<r;){var a=t.targets[t.index+(o-r)*t.columns];if(a&&!a.inert&&!a.disabled)break;o++}t.index+=t.columns*(o-r);var i=t.targets[t.index];i&&A(e,i)},y=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.rows-1;o>r;){var a=t.targets[t.index+(o-r)*t.columns];if(a&&!a.inert&&!a.disabled)break;o--}t.index+=t.columns*(o-r);var i=t.targets[t.index];i&&A(e,i)},M=function(e){var t=n.get(e),r=t.targets[0];!r||r.inert||r.disabled||(t.index=0,A(e,r))},k=function(e){var t=n.get(e),r=t.targets[t.columns-1];!r||r.inert||r.disabled||(t.index=t.columns-1,A(e,r))},L=function(e){var t=n.get(e),r=t.targets[t.columns*(t.rows-1)];!r||r.inert||r.disabled||(t.index=t.columns*(t.rows-1),A(e,r))},I=function(e){var t=n.get(e),r=t.targets[t.columns*t.rows-1];!r||r.inert||r.disabled||(t.index=t.columns*t.rows-1,A(e,r))},A=function(e,t){var r=n.get(e);r.active.tabIndex=-1,r.active=t,r.active.tabIndex=0,r.active.focus(),r.focused=!0};export{m as rovingGrid,b as updateRover};
//# sourceMappingURL=index.module.js.map
