function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.apply(this,arguments)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=new Map,o="rtl"===window.getComputedStyle(document.documentElement).direction,a={TOP_LEFT:[],TOP:["Ctrl+Home","Meta+ArrowUp"],TOP_RIGHT:[],UP:["ArrowUp"],DOWN:["ArrowDown"],HOME:["Home","Meta+ArrowLeft"],END:["End","Meta+ArrowRight"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"],BOTTOM_LEFT:[],BOTTOM:["Ctrl+End","Meta+ArrowDown"],BOTTOM_RIGHT:[]},i=function(e,t){if((t.includes("ArrowLeft")||1==t.length)&&!t.includes("Home")){var r=e.findIndex(function(e){return e.includes("ArrowRight")||1==e.length});return-1!==r?e[r]:t}if((t.includes("ArrowRight")||1==t.length)&&!t.includes("End")){var n=e.findIndex(function(e){return e.includes("ArrowLeft")||1==e.length});return-1!==n?e[n]:t}return t},u=function(t){void 0===t&&(t={});var r=e({},a,t);if(o){var n=[r.RIGHT,r.LEFT];r.LEFT=n[0],r.RIGHT=n[1];var u=[r.TOP_RIGHT,r.TOP_LEFT];r.TOP_LEFT=u[0],r.TOP_RIGHT=u[1];var s=[r.BOTTOM_RIGHT,r.BOTTOM_LEFT];r.BOTTOM_LEFT=s[0],r.BOTTOM_RIGHT=s[1];var c=r.HOME,l=r.END;r.HOME=c.map(function(e){return i(l,e)}),r.END=l.map(function(e){return i(c,e)})}for(var f in r)r[f]=r[f].map(function(e){return e.split("+").map(function(e){return 1===e.length?e.toUpperCase():e}).join("+")});var d={},v=function(e){r[e].forEach(function(t){d[t]=e})};for(var g in r)v(g);return d},s=function(e){for(var t,o=e.currentTarget,a=n.get(o),i=r([].concat(a.targets).entries());!(t=i()).done;){var u=t.value,s=u[0],c=u[1];if(c.contains(e.target)){e.preventDefault(),a.index=s,a.focused=!0,I(o,c),n.set("last_rover",o);break}}},c=function(e){var t=e.currentTarget,r=e.target;if(n.has(t)){var o=n.get(t),a=[].concat(o.targets).indexOf(r);-1!==a&&o.index!==a&&(o.index=a,o.focused=!0,I(t,r),n.set("last_rover",t))}},l=function(e){var t=n.get(e.currentTarget);t&&(t.focused=!1)},f=function(e){var t=e.currentTarget,r=function(e){var t=[e.ctrlKey?"Ctrl":null,e.altKey?"Alt":null,e.shiftKey?"Shift":null,e.metaKey?"Meta":null].filter(Boolean),r=1===e.key.length?e.key.toUpperCase():e.key;return t.length>0?t.join("+")+"+"+r:r}(e);switch(n.get(t).keyBinds[r]){case"RIGHT":e.preventDefault(),b(t);break;case"LEFT":e.preventDefault(),p(t);break;case"DOWN":e.preventDefault(),h(t);break;case"UP":e.preventDefault(),T(t);break;case"HOME":e.preventDefault(),w(t);break;case"END":e.preventDefault(),x(t);break;case"BOTTOM":e.preventDefault(),E(t);break;case"TOP":e.preventDefault(),O(t);break;case"TOP_LEFT":e.preventDefault(),y(t);break;case"TOP_RIGHT":e.preventDefault(),M(t);break;case"BOTTOM_LEFT":e.preventDefault(),k(t);break;case"BOTTOM_RIGHT":e.preventDefault(),L(t)}},d=function(t,r){var o=t.querySelectorAll(r),a=v(t,o),i=Math.ceil(o.length/a),u=n.get(t),s=u.columns,c=u.index,l=Math.floor(c/s),f=c%s,d=Math.min(l,i-1)*a+Math.min(f,a-1),g=o[d];o.forEach(function(e){return e.tabIndex=-1}),g.tabIndex=0,u.focused&&I(t,g),n.set(t,e({},u,{targets:o,columns:a,rows:i,active:g,index:d}))},v=function(e,t){var r=window.getComputedStyle(e);if(r.getPropertyValue("grid-template-columns"))return r.getPropertyValue("grid-template-columns").split(" ").length;for(var n=e.offsetWidth,o=[].concat(t),a=0,i=0,u=0,s=o.length;u<s;u++){var c=o[u];a+=Math.floor(c.offsetWidth);var l=t[u+1];if(l){var f=l.offsetLeft-(c.offsetLeft+c.offsetWidth);f>0&&(a+=Math.floor(f))}if(a>n)break;i++}return i},g=function(e){var t=e.element,o=e.target,a=void 0===o?":scope *":o,i=e.wrap,g=void 0===i||i,m=e.VKMap,b=void 0===m?{}:m,p=t.querySelectorAll(a),h=p[0],T=v(t,p),w=function(e,t){var r=window.getComputedStyle(e);return r.getPropertyValue("grid-template-rows")?r.getPropertyValue("grid-template-rows").split(" ").length:Math.ceil(t.length/v(e,t))}(t,p),x=u(b);t.tabIndex=-1,p.forEach(function(e){return e.tabIndex=-1}),h.tabIndex=0,n.set(t,{targets:p,wrap:g,active:h,index:0,rows:w,columns:T,focused:!1,keyBinds:x}),t.addEventListener("pointerdown",s),t.addEventListener("focusin",c),t.addEventListener("focusout",l),t.addEventListener("keydown",f);var O=function(e,t){var r=new MutationObserver(function(r,n){r.forEach(function(r){"childList"===r.type&&e.contains(r.target)&&d(e,t)})});return r.observe(e,{childList:!0,subtree:!0}),r}(t,a),E=function(e,t){var n=new ResizeObserver(function(n){for(var o=r(n);!o().done;)d(e,t)});return n.observe(e),e.querySelectorAll(t).forEach(function(e){n.observe(e)}),n}(t,a);!function(e,t){var r=(void 0===t?{}:t).observers,o=void 0===r?[]:r,a=e.parentNode,i=new MutationObserver(function(e,t){e.filter(function(e){return e.removedNodes.length>0}).forEach(function(e){[].concat(e.removedNodes).filter(function(e){return 1===e.nodeType}).forEach(function(e){n.forEach(function(t,r){"last_rover"!==r&&e.contains(r)&&(r.removeEventListener("pointerdown",s),r.removeEventListener("focusin",c),r.removeEventListener("focusout",l),r.removeEventListener("keydown",f),n.delete(r),t.targets.forEach(function(e){return e.tabIndex=""}),(0===n.size||1===n.size&&n.has("last_rover"))&&(n.clear(),i.disconnect(),o.forEach(function(e){return e.disconnect()})))})})})});i.observe(a,{childList:!0,subtree:!0})}(t,{observers:[O,E]})},m=function(t,r){var o=n.get(t);if(!o)throw new Error("Rover not found");var a=e({},o,r);r.VKMap&&(a.keyBinds=u(r.VKMap)),n.set(t,a)},b=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.wrap?t.targets.length-1:(r+1)*t.columns-1,a=t.index;a<o;){a++;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,I(e,i);break}}},p=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.wrap?0:r*t.columns,a=t.index;a>o;){a--;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,I(e,i);break}}},h=function(e){for(var t=n.get(e),r=t.rows*t.columns+t.index%t.columns,o=t.index;o<r;){var a=t.targets[o+=t.columns];if(a&&!a.inert&&!a.disabled){t.index=o,I(e,a);break}}},T=function(e){for(var t=n.get(e),r=t.index%t.columns,o=t.index;o>r;){var a=t.targets[o-=t.columns];if(a&&!a.inert&&!a.disabled){t.index=o,I(e,a);break}}},w=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=0;o<t.columns;){var a=t.targets[r*t.columns+o];if(a&&!a.inert&&!a.disabled)break;o++}t.index=r*t.columns+o;var i=t.targets[t.index];i&&I(e,i)},x=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.columns-1;o>=0;){var a=t.targets[r*t.columns+o];if(a&&!a.inert&&!a.disabled)break;o--}t.index=r*t.columns+o;var i=t.targets[t.index];i&&I(e,i)},O=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=0;o<r;){var a=t.targets[t.index+(o-r)*t.columns];if(a&&!a.inert&&!a.disabled)break;o++}t.index+=t.columns*(o-r);var i=t.targets[t.index];i&&I(e,i)},E=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.rows-1;o>r;){var a=t.targets[t.index+(o-r)*t.columns];if(a&&!a.inert&&!a.disabled)break;o--}t.index+=t.columns*(o-r);var i=t.targets[t.index];i&&I(e,i)},y=function(e){var t=n.get(e),r=t.targets[0];!r||r.inert||r.disabled||(t.index=0,I(e,r))},M=function(e){var t=n.get(e),r=t.targets[t.columns-1];!r||r.inert||r.disabled||(t.index=t.columns-1,I(e,r))},k=function(e){var t=n.get(e),r=t.targets[t.columns*(t.rows-1)];!r||r.inert||r.disabled||(t.index=t.columns*(t.rows-1),I(e,r))},L=function(e){var t=n.get(e),r=t.targets[t.columns*t.rows-1];!r||r.inert||r.disabled||(t.index=t.columns*t.rows-1,I(e,r))},I=function(e,t){var r=n.get(e);r.active.tabIndex=-1,r.active=t,r.active.tabIndex=0,r.active.focus(),r.focused=!0};export{g as rovingGrid,m as updateRover};
//# sourceMappingURL=index.module.js.map
