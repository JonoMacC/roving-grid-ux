function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.apply(this,arguments)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=new Map,o="rtl"===window.getComputedStyle(document.documentElement).direction,a={TOP_LEFT:[],TOP:["Ctrl+Home","Meta+ArrowUp"],TOP_RIGHT:[],UP:["ArrowUp"],DOWN:["ArrowDown"],HOME:["Home","Meta+ArrowLeft"],END:["End","Meta+ArrowRight"],LEFT:["ArrowLeft"],RIGHT:["ArrowRight"],BOTTOM_LEFT:[],BOTTOM:["Ctrl+End","Meta+ArrowDown"],BOTTOM_RIGHT:[]},i=function(e,t){if((t.includes("ArrowLeft")||1==t.length)&&!t.includes("Home")){var r=e.findIndex(function(e){return e.includes("ArrowRight")||1==e.length});return-1!==r?e[r]:t}if((t.includes("ArrowRight")||1==t.length)&&!t.includes("End")){var n=e.findIndex(function(e){return e.includes("ArrowLeft")||1==e.length});return-1!==n?e[n]:t}return t},c=function(t){void 0===t&&(t={});var r=e({},a,t);if(o){var n=[r.RIGHT,r.LEFT];r.LEFT=n[0],r.RIGHT=n[1];var c=[r.TOP_RIGHT,r.TOP_LEFT];r.TOP_LEFT=c[0],r.TOP_RIGHT=c[1];var s=[r.BOTTOM_RIGHT,r.BOTTOM_LEFT];r.BOTTOM_LEFT=s[0],r.BOTTOM_RIGHT=s[1];var u=r.HOME,f=r.END;r.HOME=u.map(function(e){return i(f,e)}),r.END=f.map(function(e){return i(u,e)})}for(var l in r)r[l]=r[l].map(function(e){return e.split("+").map(function(e){return 1===e.length?e.toUpperCase():e}).join("+")});var d={},v=function(e){r[e].forEach(function(t){d[t]=e})};for(var g in r)v(g);return d},s=function(e){for(var t,o=e.currentTarget,a=n.get(o),i=r([].concat(a.targets).entries());!(t=i()).done;){var c=t.value,s=c[0],u=c[1];if(u.contains(e.target)){e.preventDefault(),a.index=s,a.focused=!0,D(o,u),n.set("last_rover",o);break}}},u=function(e){var t=e.currentTarget,r=e.target;if(n.has(t)){var o=n.get(t),a=[].concat(o.targets).indexOf(r);-1!==a&&o.index!==a&&(o.index=a,o.focused=!0,D(t,r),n.set("last_rover",t))}},f=function(e){var t=n.get(e.currentTarget);t&&(t.focused=!1)},l=function(e){var t=e.currentTarget,r=function(e){var t=[e.ctrlKey?"Ctrl":null,e.altKey?"Alt":null,e.shiftKey?"Shift":null,e.metaKey?"Meta":null].filter(Boolean),r=1===e.key.length?e.key.toUpperCase():e.key;return t.length>0?t.join("+")+"+"+r:r}(e);switch(n.get(t).keyBinds[r]){case"RIGHT":e.preventDefault(),h(t);break;case"LEFT":e.preventDefault(),T(t);break;case"DOWN":e.preventDefault(),x(t);break;case"UP":e.preventDefault(),w(t);break;case"HOME":e.preventDefault(),O(t);break;case"END":e.preventDefault(),E(t);break;case"BOTTOM":e.preventDefault(),M(t);break;case"TOP":e.preventDefault(),y(t);break;case"TOP_LEFT":e.preventDefault(),k(t);break;case"TOP_RIGHT":e.preventDefault(),L(t);break;case"BOTTOM_LEFT":e.preventDefault(),I(t);break;case"BOTTOM_RIGHT":e.preventDefault(),A(t)}},d=function(t,o){var a=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&t.contains(a.target)&&function(t,o){var a,i,c=t.querySelectorAll(o),s=g(t,c),u=m(t,c),f=n.get(t),l=f.columns,d=f.index,v=Math.floor(d/l),b=d%l,p=Math.min(v,u-1)*s+Math.min(b,s-1),h=c[p];if(h.disabled||h.inert){for(var T,x=r(c);!(T=x()).done;){var w=T.value;if(!w.disabled&&!w.inert){a=w;break}}i=[].concat(c).indexOf(a)}else a=h,i=p;c.forEach(function(e){return e.tabIndex=-1}),a.tabIndex=0,f.focused&&D(t,a),n.set(t,e({},f,{targets:c,columns:s,rows:u,active:a,index:i}))}(t,o)})});return a.observe(t,{childList:!0,subtree:!0}),a},v=function(t,r){var o=new ResizeObserver(function(){return function(t){var r=n.get(t),o=g(t,[].concat(r.targets)),a=m(t,[].concat(r.targets));n.set(t,e({},r,{columns:o,rows:a}))}(t)});return[t].concat(t.querySelectorAll(r)).forEach(function(e){o.observe(e)}),o},g=function(e,t){var r=window.getComputedStyle(e);if(r.getPropertyValue("grid-template-columns"))return r.getPropertyValue("grid-template-columns").split(" ").length;for(var n=e.offsetWidth,o=[].concat(t),a=0,i=0,c=0,s=o.length;c<s;c++){var u=o[c];a+=Math.floor(u.offsetWidth);var f=t[c+1];if(f){var l=f.offsetLeft-(u.offsetLeft+u.offsetWidth);l>0&&(a+=Math.floor(l))}if(a>n)break;i++}return i},m=function(e,t){var r=window.getComputedStyle(e);return r.getPropertyValue("grid-template-rows")?r.getPropertyValue("grid-template-rows").split(" ").length:Math.ceil(t.length/g(e,t))},b=function(e){for(var t,o,a=e.element,i=e.target,b=void 0===i?":scope *":i,p=e.wrap,h=void 0===p||p,T=e.VKMap,x=void 0===T?{}:T,w=a.querySelectorAll(b),O=r(w);!(o=O()).done;){var E=o.value;if(!E.disabled&&!E.inert){t=E;break}}var y=[].concat(w).indexOf(t),M=g(a,w),k=m(a,w),L=c(x);a.tabIndex=-1,w.forEach(function(e){return e.tabIndex=-1}),t.tabIndex=0,n.set(a,{targets:w,wrap:h,active:t,index:y,rows:k,columns:M,focused:!1,keyBinds:L}),a.addEventListener("pointerdown",s),a.addEventListener("focusin",u),a.addEventListener("focusout",f),a.addEventListener("keydown",l),function(e,t){void 0===t&&(t=[]);var r=e.parentNode,o=new MutationObserver(function(e){e.filter(function(e){return e.removedNodes.length>0}).forEach(function(e){[].concat(e.removedNodes).filter(function(e){return 1===e.nodeType}).forEach(function(e){n.forEach(function(r,a){"last_rover"!==a&&e.contains(a)&&(a.removeEventListener("pointerdown",s),a.removeEventListener("focusin",u),a.removeEventListener("focusout",f),a.removeEventListener("keydown",l),n.delete(a),r.targets.forEach(function(e){return e.tabIndex=""}),(0===n.size||1===n.size&&n.has("last_rover"))&&(n.clear(),o.disconnect(),t.forEach(function(e){return e.disconnect()})))})})})});o.observe(r,{childList:!0,subtree:!0})}(a,{observers:[d(a,b),v(a,b)]})},p=function(t,r){var o=n.get(t);if(!o)throw new Error("Rover not found");var a=e({},o,r);r.VKMap&&(a.keyBinds=c(r.VKMap)),n.set(t,a)},h=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.wrap?t.targets.length-1:(r+1)*t.columns-1,a=t.index;a<o;){a++;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,D(e,i);break}}},T=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.wrap?0:r*t.columns,a=t.index;a>o;){a--;var i=t.targets[a];if(i&&!i.inert&&!i.disabled){t.index=a,D(e,i);break}}},x=function(e){for(var t=n.get(e),r=t.rows*t.columns+t.index%t.columns,o=t.index;o<r;){var a=t.targets[o+=t.columns];if(a&&!a.inert&&!a.disabled){t.index=o,D(e,a);break}}},w=function(e){for(var t=n.get(e),r=t.index%t.columns,o=t.index;o>r;){var a=t.targets[o-=t.columns];if(a&&!a.inert&&!a.disabled){t.index=o,D(e,a);break}}},O=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=0;o<t.columns;){var a=t.targets[r*t.columns+o];if(a&&!a.inert&&!a.disabled)break;o++}t.index=r*t.columns+o;var i=t.targets[t.index];i&&D(e,i)},E=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.columns-1;o>=0;){var a=t.targets[r*t.columns+o];if(a&&!a.inert&&!a.disabled)break;o--}t.index=r*t.columns+o;var i=t.targets[t.index];i&&D(e,i)},y=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=0;o<r;){var a=t.targets[t.index+(o-r)*t.columns];if(a&&!a.inert&&!a.disabled)break;o++}t.index+=t.columns*(o-r);var i=t.targets[t.index];i&&D(e,i)},M=function(e){for(var t=n.get(e),r=Math.floor(t.index/t.columns),o=t.rows-1;o>r;){var a=t.targets[t.index+(o-r)*t.columns];if(a&&!a.inert&&!a.disabled)break;o--}t.index+=t.columns*(o-r);var i=t.targets[t.index];i&&D(e,i)},k=function(e){var t=n.get(e),r=t.targets[0];!r||r.inert||r.disabled||(t.index=0,D(e,r))},L=function(e){var t=n.get(e),r=t.targets[t.columns-1];!r||r.inert||r.disabled||(t.index=t.columns-1,D(e,r))},I=function(e){var t=n.get(e),r=t.targets[t.columns*(t.rows-1)];!r||r.inert||r.disabled||(t.index=t.columns*(t.rows-1),D(e,r))},A=function(e){var t=n.get(e),r=t.targets[t.columns*t.rows-1];!r||r.inert||r.disabled||(t.index=t.columns*t.rows-1,D(e,r))},D=function(e,t){var r=n.get(e);r.active.tabIndex=-1,r.active=t,r.active.tabIndex=0,r.active.focus(),r.focused=!0};export{b as rovingGrid,p as updateRover};
//# sourceMappingURL=index.module.js.map
